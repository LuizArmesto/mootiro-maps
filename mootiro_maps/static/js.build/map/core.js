(function(){define(["require","jquery","underscore","backbone"],function(e){var t,n,r,i,s;return t=e("jquery"),s=e("underscore"),n=e("backbone"),r=function(){function r(){this._components={},this._pubQueue=[],this._pubsub={},s.extend(this._pubsub,n.Events)}return r.prototype.loading=0,r.prototype.data={deferred:t.Deferred,when:t.when},r.prototype._getComponent=function(e,t){var n,r;n=(r=this._components[e])!=null?r:{};if(n[t]==null)throw new Error("Could not be found a component '"+e+"' with id '"+t+"'");return n[t]},r.prototype._removeComponent=function(e,t){var n;return(n=this._components[e])!=null?delete n[t]:void 0},r.prototype.load=function(t,n,r){var i,s,o,u,a,f=this;return a=n,o=t.split("::"),i=o[0],s=o[1],u=this.data.deferred(),e([i],function(e){var i,o;i=e[s];try{o=new i(f,n)}catch(l){typeof console!="undefined"&&console!==null&&console.error(l.message),typeof console!="undefined"&&console!==null&&console.warn("Could not initialize component '"+t+"'"),u.resolve();return}return f.data.when(o.init(r)).done(function(){return f._components[t][a].instance=o,typeof console!="undefined"&&console!==null&&console.log("Component '"+t+"' initialized"),f.publish(""+s+":started",a),u.resolve(o)}).fail(function(){return typeof console!="undefined"&&console!==null&&console.warn("Could not initialize component '"+t+"'"),u.resolve(o)})},function(n){var r;return n.requireType==="timeout"?typeof console!="undefined"&&console!==null&&console.warn("Could not load module '"+n.requireModules+"'"):(r=n.requireModules&&n.requireModules[0],e.undef(r),typeof console!="undefined"&&console!==null&&console.error(n.message),typeof console!="undefined"&&console!==null&&console.warn("Could not initialize component '"+t+"'")),u.resolve()}),u.promise()},r.prototype.unload=function(e){},r.prototype.start=function(e,n,r){var i,o,u,a,f,l,c,h,p,d,v,m=this;r==null&&(r={}),s.isString(e)?o=[{component:e,el:n,opts:r}]:s.isArray(e)?o=e:o=[e];if(!s.isArray(o))throw new Error("componentList must be defined as an array");c=[];for(d=0,v=o.length;d<v;d++)l=o[d],i=l.component,n=l.el,r=l.opts,this.loading++,f=n,(p=this._components)[i]==null&&(p[i]={}),u=this._components[i],u[f]!=null&&typeof console!="undefined"&&console!==null&&console.error("Conflict: already exists one component '"+i+"' with id '"+f+"' "),this._components[i][f]={type:i,el:n,opts:r},a=this.data.deferred(),c.push(this.load(i,n,r));return h=this.data.when.apply(t,c),h.done(function(){return m.loading-=arguments.length,m._processPublishQueue()}),h},r.prototype.stop=function(e,n){var r,i,o,u,a,f,l,c,h;a=n,f=s.isArray(a)?a:[a],o=this.data.deferred(),l=f.length,u=0;for(c=0,h=f.length;c<h;c++)r=f[c],i=this._getComponent(e,r),i.instance.destroy().done(function(){t(i.el).children().remove(),this._removeComponent(e,r),u++;if(u===l)return o.resolve()});return o.promise()},r.prototype.publish=function(e){return this._addToPublishQueue.apply(this,arguments),this._processPublishQueue()},r.prototype.subscribe=function(e,t,n){return this._pubsub.on(e,t,n)},r.prototype._addToPublishQueue=function(e){return this._pubQueue.push(arguments)},r.prototype._processPublishQueue=function(){var e;if(this.loading>0)return!1;e=this._pubQueue.shift();if(e!=null)return this._pubsub.trigger.apply(this._pubsub,e),this._processPublishQueue()},r}(),i={Mediator:r},i})}).call(this);