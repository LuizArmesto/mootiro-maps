(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["googlemaps","map/common","map/multimarker","map/multipolyline"],function(e,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;return window.komoo==null&&(window.komoo={}),(w=window.komoo).event==null&&(w.event=e.event),r=n.geometries.types.EMPTY,p=n.geometries.types.POINT,f=n.geometries.types.MULTIPOINT,d=n.geometries.types.POLYGON,v=n.geometries.types.LINESTRING,o=n.geometries.types.LINESTRING,l=n.geometries.types.MULTILINESTRING,a=n.geometries.types.MULTILINESTRING,b={BACKGROUND_COLOR:"#000",BACKGROUND_OPACITY:.6,BORDER_COLOR:"#000",BORDER_OPACITY:.6,BORDER_SIZE:1.5,BORDER_SIZE_HOVER:2.5,ZINDEX:1},s=function(){function t(e){this.options=e!=null?e:{},this.setFeature(this.options.feature),this.initOverlay(this.options)}return t.prototype.initOverlay=function(e){throw"Not Implemented"},t.prototype.getCoordinates=function(){throw"Not Implemented"},t.prototype.setCoordinates=function(e){return komoo.event.trigger(this,"coordinates_changed")},t.prototype.setEditable=function(e){throw"Not Implemented"},t.prototype.initEvents=function(e){var t,n=this;e==null&&(e=this.overlay);if(!e)return;return t=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,r){return komoo.event.trigger(n,t,e,r)})})},t.prototype.calculateBounds=function(){var t,n,r,i,s,o,u,a,f,c,h,p,v,m;o=f=c=r=null,s=function(e){return o==null&&(o=f!=null?f:f=e[0]),c==null&&(c=r!=null?r:r=e[1]),o=Math.max(e[0],o),f=Math.min(e[0],f),c=Math.min(e[1],c),r=Math.max(e[1],r),[[f,c],[o,r]]},n=this.getCoordinates(),i=this.getGeometryType(),i!==d&&i!==l&&(n=[n]);for(h=0,v=n.length;h<v;h++){u=n[h];for(p=0,m=u.length;p<m;p++)a=u[p],t=s(a)}return t!=null&&(this.bounds=new e.LatLngBounds(this.getLatLngFromArray(t[0]),this.getLatLngFromArray(t[1]))),this.bounds},t.prototype.getBounds=function(){return this.bounds!=null?this.bounds:this.calculateBounds()},t.prototype.getCenter=function(){var e,t,n;return this.overlay?this.getArrayFromLatLng((typeof (e=this.overlay).getCenter=="function"?e.getCenter():void 0)||((n=this.getBounds())!=null?n.getCenter():void 0)||(typeof (t=this.overlay).getPosition=="function"?t.getPosition():void 0)):[]},t.prototype.getOverlay=function(){return this.overlay},t.prototype.setOverlay=function(e){return this.overlay=e,this.initEvents()},t.prototype.getFeature=function(){return this.feature},t.prototype.setFeature=function(e){this.feature=e},t.prototype.getGeometryType=function(){return this.geometryType},t.prototype.getDefaultZIndex=function(){var e;return((e=this.feature)!=null?e.getDefaultZIndex():void 0)||b.ZINDEX},t.prototype.getLatLngFromArray=function(t){return t!=null?new e.LatLng(t[0],t[1]):null},t.prototype.getArrayFromLatLng=function(e){return e?[e.lat(),e.lng()]:[]},t.prototype.getLatLngArrayFromArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i},t.prototype.getArrayFromLatLngArray=function(e){var t,n,r,i;if(e){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getArrayFromLatLng(t));return i}return[]},t.prototype.getMap=function(){return this.map},t.prototype.setMap=function(e){var t;return this.map=e,(t=this.overlay)!=null?t.setMap(this.map&&this.map.googleMap?this.map.googleMap:this.map):void 0},t.prototype.getVisible=function(){var e;return(e=this.overlay)!=null?e.getVisible():void 0},t.prototype.setVisible=function(e){var t;return(t=this.overlay)!=null?t.setVisible(e):void 0},t.prototype.setOptions=function(e){var t;return this.options=e,(t=this.overlay)!=null?t.setOptions(this.options):void 0},t.prototype.getIcon=function(){var e;return(e=this.overlay)!=null?typeof e.getIcon=="function"?e.getIcon():void 0:void 0},t.prototype.setIcon=function(e){var t;return(t=this.overlay)!=null?typeof t.setIcon=="function"?t.setIcon(e):void 0:void 0},t.prototype.getIconUrl=function(e){var t;return(t=this.feature)!=null?t.getIconUrl(e):void 0},t.prototype.getGeoJson=function(){return{type:this.getGeometryType(),coordinates:this.getCoordinates()}},t}(),i=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.geometryType=r,n.prototype.getOverlayOptions=function(e){return{}},n.prototype.initOverlay=function(e){return this.options=e!=null?e:{},!0},n.prototype.getCoordinates=function(){return[]},n.prototype.setEditable=function(e){return!0},n.prototype.getGeoJson=function(){return null},n}(s),m=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.geometryType=p,r.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),icon:(r=e.icon)!=null?r:this.getIconUrl(e.zoom)}},r.prototype.initOverlay=function(t){return this.setOverlay(new e.Marker(this.getOverlayOptions(t)))},r.prototype.initEvents=function(e){var t,n=this;return e==null&&(e=this.overlay),r.__super__.initEvents.call(this,e),t=["animation_changed","clickable_changed","cursor_changed","drag","dragend","daggable_changed","dragstart","flat_changed","icon_changed","position_changed","shadow_changed","shape_changed","title_changed","visible_changed","zindex_changed"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,r){return komoo.event.trigger(n,t,e,r)})})},r.prototype.getCoordinates=function(){return this.getArrayFromLatLng(this.overlay.getPosition())},r.prototype.setCoordinates=function(e){return this.bounds=null,this.overlay.setPosition(this.getLatLngFromArray(e)),r.__super__.setCoordinates.call(this,e)},r.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},r.prototype.getPosition=function(){return this.overlay.getPosition()},r.prototype.setPosition=function(e){return this.overlay.setPosition(e instanceof Array?this.getLatLngFromArray(e):e)},r.prototype.addMarker=function(e){return this.setOverlay(e)},r}(s),h=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.geometryType=f,r.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),icon:(r=e.icon)!=null?r:this.getIconUrl(e.zoom)}},r.prototype.initOverlay=function(e){return this.setOverlay(new MultiMarker(this.getOverlayOptions(e)))},r.prototype.getPoints=function(){return this.overlay.getMarkers().getArray()},r.prototype.setPoints=function(e){return this.overlay.addMarkers(e)},r.prototype.guaranteePoints=function(t){var n,r,i,s,o,u;r=this.overlay.getMarkers();if(r.length>=t){o=[];for(n=0,i=r.length-t-1;0<=i?n<=i:n>=i;0<=i?n++:n--)o.push(r.pop());return o}u=[];for(n=0,s=t-r.length-1;0<=s?n<=s:n>=s;0<=s?n++:n--)u.push(this.overlay.addMarker(new e.Marker(this.options)));return u},r.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e.getPosition()));return i},r.prototype.setCoordinates=function(e){var t,n,i,s;e[0]instanceof Array||(e=[e]),this.guaranteePoints(e.length),this.bounds=null,s=this.getPoints();for(t=0,i=s.length;t<i;t++)n=s[t],n.setPosition(this.getLatLngFromArray(e[t]));return r.__super__.setCoordinates.call(this,e)},r.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},r.prototype.getPositions=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.getPosition());return i},r.prototype.setPositions=function(e){return this.overlay.setPositions(e)},r.prototype.getMarkers=function(){return this.overlay.getMarkers()},r.prototype.addMarkers=function(e){return this.overlay.addMarkers(e)},r.prototype.addMarker=function(e){return this.overlay.addMarker(e)},r}(s),y=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.geometryType=p,n.prototype.getGeoJson=function(){return{type:f,coordinates:this.getCoordinates()}},n}(h),u=function(n){function r(e){r.__super__.constructor.call(this,e),this.handleEvents()}return t(r,n),r.prototype.geometryType=o,r.prototype.getOverlayOptions=function(e){var t,n,r,i,s;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),strokeColor:(r=e.strokeColor)!=null?r:this.getBorderColor(),strokOpacity:(i=e.strokeOpacity)!=null?i:this.getBorderOpacity(),strokeWeight:(s=e.strokeWeight)!=null?s:this.getBorderSize()}},r.prototype.initOverlay=function(t){return this.setOverlay(new e.Polyline(this.getOverlayOptions(t)))},r.prototype.handleEvents=function(){var e=this;return komoo.event.addListener(this,"mousemove",function(t){return e.setOptions({strokeWeight:e.getBorderSizeHover()})}),komoo.event.addListener(this,"mouseout",function(t){return e.setOptions({strokeWeight:e.getBorderSize()})})},r.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPath().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e));return i},r.prototype.setCoordinates=function(e){var t;return this.overlay.setPath(function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i}.call(this))},r.prototype.setEditable=function(e){return this.overlay.setEditable(e)},r.prototype.getBorderColor=function(){var e;return((e=this.feature)!=null?e.getBorderColor():void 0)||b.BORDER_COLOR},r.prototype.getBorderOpacity=function(){var e;return((e=this.feature)!=null?e.getBorderOpacity():void 0)||b.BORDER_OPACITY},r.prototype.getBorderSize=function(){var e;return((e=this.feature)!=null?e.getBorderSize():void 0)||b.BORDER_SIZE},r.prototype.getBorderSizeHover=function(){var e;return((e=this.feature)!=null?e.getBorderSizeHover():void 0)||b.BORDER_SIZE_HOVER},r.prototype.getPath=function(){return this.overlay.getPath()},r.prototype.setPath=function(e){return this.overlay.setPath(e)},r}(s),c=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.geometryType=l,r.prototype.initOverlay=function(e){return this.setOverlay(new MultiPolyline(this.getOverlayOptions(e)))},r.prototype.guaranteeLines=function(t){var n,r,i,s,o,u;r=this.overlay.getPolylines();if(r.length>=t){o=[];for(n=0,i=r.length-t-1;0<=i?n<=i:n>=i;0<=i?n++:n--)o.push(r.pop());return o}u=[];for(n=0,s=t-r.length-1;0<=s?n<=s:n>=s;0<=s?n++:n--)u.push(this.overlay.addPolyline(new e.Polyline(this.options)));return u},r.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPolylines().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLngArray(e.getPath().getArray()));return i},r.prototype.setCoordinates=function(e){var t,n,r,i,s;e[0][0]instanceof Array||(e=[e]),this.guaranteeLines(e.length),this.bounds=null,i=this.getLines(),s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(n.setPath(this.getLatLngArrayFromArray(e[t])));return s},r.prototype.getBorderSize=function(){return r.__super__.getBorderSize.call(this)+1},r.prototype.getBorderSizeHover=function(){return r.__super__.getBorderSizeHover.call(this)+1},r.prototype.getPath=function(){return this.getPaths().getAt(0)},r.prototype.getPaths=function(){return this.overlay.getPaths()},r.prototype.setPaths=function(e){return this.overlay.setPaths(e)},r.prototype.getLines=function(){return this.overlay.getPolylines().getArray()},r.prototype.setLines=function(e){return this.overlay.addPolylines(e)},r.prototype.addPolyline=function(e,t){return this.overlay.addPolyline(e,t)},r.prototype.getPolylines=function(){return this.overlay.getPolylines()},r}(u),g=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.geometryType=d,r.prototype.getOverlayOptions=function(e){var t,n,r,i,s,o,u;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),fillColor:(r=e.fillColor)!=null?r:this.getBackgroundColor(),fillOpacity:(i=e.fillOpacity)!=null?i:this.getBackgroundOpacity(),strokeColor:(s=e.strokeColor)!=null?s:this.getBorderColor(),strokeOpacity:(o=e.strokeOpacity)!=null?o:this.getBorderOpacity(),strokeWeight:(u=e.strokeWeight)!=null?u:this.getBorderSize()}},r.prototype.initOverlay=function(t){return this.setOverlay(new e.Polygon(this.getOverlayOptions(t)))},r.prototype.getBackgroundColor=function(){var e;return((e=this.feature)!=null?e.getBackgroundColor():void 0)||b.BACKGROUND_COLOR},r.prototype.getBackgroundOpacity=function(){var e;return((e=this.feature)!=null?e.getBackgroundOpacity():void 0)||b.BACKGROUND_OPACITY},r.prototype.getCoordinates=function(){var e,t,n,r,i,s;e=[],s=this.overlay.getPaths().getArray();for(r=0,i=s.length;r<i;r++)t=s[r],n=this.getArrayFromLatLngArray(t.getArray()),n.length&&n.push(n[0]),n.length>0&&e.push(n);return e},r.prototype.setCoordinates=function(e){var t,n,r,i,s;n=[],this.bounds=null;for(i=0,s=e.length;i<s;i++)r=e[i],t=this.getLatLngArrayFromArray(r),t.pop(),n.push(t);return this.setPaths(n)},r.prototype.getPath=function(){return this.getPaths().getAt(0)},r.prototype.getPaths=function(){return this.overlay.getPaths()},r.prototype.setPaths=function(e){return this.overlay.setPaths(e)},r}(u),window.komoo.geometries={types:{EMPTY:r,POINT:p,MULTIPOINT:f,POLYGON:d,POLYLINE:v,LINESTRING:o,MULTIPOLYLINE:l,MULTILINESTRING:a},MultiMarker:MultiMarker,Geometry:s,Empty:i,Point:y,MultiPoint:h,LineString:u,MultiLineString:c,Polygon:g,defaults:b,makeGeometry:function(e,t){var n,r,s,o;s={feature:t};if(e.geometry==null)return new i(s);o=e.geometry.type,n=e.geometry.coordinates;if(o==="Point")r=new y(s);else if(o==="MultiPoint"||o==="marker")r=new h(s);else if(o==="LineString"||o==="polyline")n&&(n=[n]),r=new c(s);else if(o==="MultiLineString")r=new c(s);else if(o==="Polygon"||o==="polygon")r=new g(s);return n&&r!=null&&r.setCoordinates(n),r}},window.komoo.geometries})}).call(this);